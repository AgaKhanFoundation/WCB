PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE `achievement` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL UNIQUE, `distance` INTEGER NOT NULL, UNIQUE (name));
CREATE TABLE `team` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL UNIQUE, UNIQUE (name));
CREATE TABLE `achievements` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `team_id` INTEGER REFERENCES `team` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `achievement_id` INTEGER REFERENCES `achievement` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, UNIQUE (team_id, achievement_id));
CREATE TABLE `cause` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL UNIQUE, UNIQUE (name));
CREATE TABLE `donor` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL UNIQUE, `luminate_id` VARCHAR(255) NOT NULL UNIQUE, UNIQUE (name), UNIQUE (luminate_id));
CREATE TABLE `source` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL UNIQUE, UNIQUE (name));
CREATE TABLE `locality` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL UNIQUE, UNIQUE (name));
CREATE TABLE `event` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL UNIQUE, `description` TEXT NOT NULL, `start_date` DATETIME NOT NULL, `end_date` DATETIME NOT NULL, `team_limit` INTEGER NOT NULL, `team_building_start` DATETIME NOT NULL, `team_building_end` DATETIME NOT NULL, `locality_id` INTEGER REFERENCES `locality` (`id`) ON DELETE SET NULL ON UPDATE CASCADE, `cause_id` INTEGER REFERENCES `cause` (`id`) ON DELETE SET NULL ON UPDATE CASCADE, UNIQUE (name));
CREATE TABLE `participant` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `fbid` VARCHAR(255) NOT NULL UNIQUE, `team_id` INTEGER REFERENCES `team` (`id`) ON DELETE SET NULL ON UPDATE CASCADE, `source_id` INTEGER REFERENCES `source` (`id`) ON DELETE SET NULL ON UPDATE CASCADE, `cause_id` INTEGER REFERENCES `cause` (`id`) ON DELETE SET NULL ON UPDATE CASCADE, `event_id` INTEGER REFERENCES `event` (`id`) ON DELETE SET NULL ON UPDATE CASCADE, UNIQUE (fbid));
CREATE TABLE `donors` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `participant_id` INTEGER REFERENCES `participant` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `donor_id` INTEGER REFERENCES `donor` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, UNIQUE (participant_id, donor_id));
CREATE TABLE `record` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `date` DATETIME NOT NULL, `distance` INTEGER NOT NULL, `participant_id` INTEGER REFERENCES `participant` (`id`) ON DELETE SET NULL ON UPDATE CASCADE, `source_id` INTEGER REFERENCES `source` (`id`) ON DELETE SET NULL ON UPDATE CASCADE);
CREATE TABLE `sponsor` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `name` VARCHAR(255) NOT NULL UNIQUE, `luminate_id` VARCHAR(255) NOT NULL UNIQUE, UNIQUE (name), UNIQUE (luminate_id));
CREATE TABLE `sponsors` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `participant_id` INTEGER REFERENCES `participant` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, `sponsor_id` INTEGER REFERENCES `sponsor` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, UNIQUE (participant_id, sponsor_id));
COMMIT;
